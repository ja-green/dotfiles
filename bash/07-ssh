# [ -z "${SSH_AUTH_SOCK}" ] || return

# eval $(ssh-agent -s)

# expect << EOF
# spawn ssh-add "${HOME}/.ssh/id_rsa"
# expect "Enter passphrase"
# send "$(lpass show --password ssh)\r"
# expect eof
# EOF

if [ ! -S ~/.ssh/ssh_auth_sock ]; then
  eval $(ssh-agent)
  ln -sf "${SSH_AUTH_SOCK}" ~/.ssh/ssh_auth_sock
fi

export SSH_AUTH_SOCK="${HOME}/.ssh/ssh_auth_sock"
ssh-add -l > /dev/null || ssh-add

trap 'test -n "${SSH_AUTH_SOCK}" && eval $(ssh-agent -k)' 0
